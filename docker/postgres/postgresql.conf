# PostgreSQL配置优化 - 针对pgvector和法则链系统
# =================================================================

# 内存设置
shared_buffers = 256MB                    # 共享缓冲区，建议为总内存的25%
effective_cache_size = 1GB                # 操作系统缓存估计值
work_mem = 64MB                          # 排序和哈希操作的工作内存
maintenance_work_mem = 256MB             # 维护操作内存（VACUUM, CREATE INDEX等）

# 向量操作优化
random_page_cost = 1.1                   # 随机页面访问成本，SSD优化
effective_io_concurrency = 200           # 并发I/O操作数

# 连接设置
max_connections = 100                     # 最大连接数
shared_preload_libraries = 'pg_stat_statements'  # 预加载统计模块

# 日志设置
logging_collector = on                    # 启用日志收集
log_directory = 'logs'                   # 日志目录
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'
log_rotation_size = 100MB                # 日志轮转大小
log_min_duration_statement = 1000       # 记录执行时间超过1秒的语句

# 性能监控
track_activities = on
track_counts = on
track_functions = all
track_io_timing = on

# 向量索引优化参数
# 这些参数需要在会话级别设置，在postgresql.conf中设置为默认值
# ivfflat.probes = 10                    # IVFFLAT索引探测数量

# WAL设置
wal_level = replica                      # WAL级别
max_wal_senders = 3                      # 最大WAL发送进程数
checkpoint_completion_target = 0.9       # 检查点完成目标

# 自动清理
autovacuum = on                          # 启用自动清理
autovacuum_analyze_scale_factor = 0.1    # 自动分析比例因子
autovacuum_vacuum_scale_factor = 0.2     # 自动清理比例因子

# 统计信息
default_statistics_target = 100          # 默认统计目标

# 本地化设置
timezone = 'UTC'
log_timezone = 'UTC'
datestyle = 'iso, mdy'
lc_messages = 'en_US.utf8'
lc_monetary = 'en_US.utf8'
lc_numeric = 'en_US.utf8'
lc_time = 'en_US.utf8'
default_text_search_config = 'pg_catalog.english'